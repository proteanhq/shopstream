debug = true
testing = false
secret_key = "${SECRET_KEY|c349a2e36bf9e8bd7d117c4c789f22167gc3d2f1d623d1a482e1b348c1ef9dfd}"
identity_strategy = "uuid"
identity_type = "string"
event_processing = "async"
command_processing = "sync"
message_processing = "sync"

# Outbox pattern: events are written to an outbox table in the same
# transaction as the aggregate mutation, then asynchronously forwarded
# to the broker (Redis Streams) by the Engine's OutboxProcessor.
enable_outbox = true

[outbox]
broker = "default"
messages_per_tick = 50
tick_interval = 0.01

# Default Database Configuration (used in development / PROTEAN_ENV unset)
[databases.default]
provider = "postgresql"
database_uri = "${CATALOGUE_DATABASE_URL|postgresql://postgres:postgres@localhost:15432/catalogue_local}"

# Default Event Store Configuration
[event_store]
provider = "message_db"
database_uri = "${MESSAGE_DB_URL|postgresql://message_store:message_store@localhost:15433/message_store}"

# Default Broker Configuration
[brokers.default]
provider = "redis"
URI = "redis://127.0.0.1:16379/0"

# ──────────────────────────────────────────────
# Test overrides (PROTEAN_ENV=test)
# Separate database so test runs don't destroy dev data.
# ──────────────────────────────────────────────
[test]
testing = true
event_processing = "sync"

[test.databases.default]
database_uri = "${TEST_CATALOGUE_DATABASE_URL|postgresql://postgres:postgres@localhost:15432/catalogue_test}"

# ──────────────────────────────────────────────
# Production overrides (PROTEAN_ENV=production)
# Events are processed asynchronously by Engine workers,
# not synchronously during UoW commit.
# ──────────────────────────────────────────────
[production]
event_processing = "async"
debug = false

[production.databases.default]
database_uri = "${CATALOGUE_DATABASE_URL|postgresql://postgres:postgres@localhost:15432/catalogue}"
